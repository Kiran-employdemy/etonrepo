/**
 *
 *
 *
 * - THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY -
 * - Generated by Gulp (gulp-babel).
 *
 *
 *
 *
 */


'use strict';

// tracking vars
var elqTrackingTimerId = null;
var elqCookieTrackingUrl = 'securetracking.eaton.com';
var elqSiteIdProduction = '1521';
var elqSiteIdSandbox = '1975530148';

// GUID vars
var elqGuidTimeoutSel = '#eloquaGuidTimeout';
var elqGuidTimeout = $(elqGuidTimeoutSel).val();
var elqGuidTimeoutHalf = elqGuidTimeout / 2;
var elqGuidTimerIntervalMs = 1000;
var elqGuidTimerId = null;
var elqGuidCookiePat = '=(.*)';
var elqGuidCookieName = 'ELOQUA';
var elqGuidSuffix = '&FPCVISITED';
var eatonElqFirstParty = 'First Party';
var eatonElqThirdParty = 'Third Party';

/**
* Set eloqua site id, secure tracking url, and pageview tracking
*/
var setEloquaTracking = function setEloquaTracking() {

  window._elqQ = window._elqQ || [];

  // eslint-disable-next-line no-undef
  if (typeof OptanonActiveGroups !== 'undefined') {

    clearInterval(elqTrackingTimerId);

    // eslint-disable-next-line no-undef
    if (OptanonActiveGroups.includes(',C0003,') && !window.location.href.includes('@')) {

      try {

        var hostname = new URL(window.location.href).hostname.match(/\.(.*?)\.com/gm)[0];
        var elqSiteId = hostname.includes('eaton') ? elqSiteIdProduction : elqSiteIdSandbox;
        window._elqQ.push(['elqSetSiteId', elqSiteId]);
        hostname.includes('eaton') && window._elqQ.push(['elqUseFirstPartyCookie', elqCookieTrackingUrl]);
        window._elqQ.push(['elqTrackPageView', window.location.href]);
        elqGuidTimerId = setInterval(doElqGuidOps, elqGuidTimerIntervalMs);
      } catch (err) {
        console.error(err);
      }
    }
  }
};

/**
 * Load the Eloqua configuration script
 */
// eslint-disable-next-line camelcase
var async_load = function async_load() {
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//img.en25.com/i/elqCfg.min.js';
  var x = document.getElementsByTagName('script')[0];
  x.parentNode.insertBefore(s, x);
};

/**
  * Append guid to eloqua form
  */
var appendElqGuid = function appendElqGuid(guid) {
  $('.elq-form').append($('<input>').attr({ type: 'hidden', name: 'elqCookieWrite', value: '0' }));
  $('.elq-form').append($('<input>').attr({ type: 'hidden', name: 'elqCustomerGUID', value: guid }));
};

/*
* Try getting the first party cookie for the first half of timer duration and third party for second half
* If a guid is found, it is appended to the data layer and form (if eloqua form page for the latter)
*/
var doElqGuidOps = function doElqGuidOps() {

  var elqGuid = null;
  // eslint-disable-next-line no-unused-vars
  var elqGuidType = null;

  if (elqGuidTimeout > elqGuidTimeoutHalf) {

    // first party
    elqGuid = $.cookie(elqGuidCookieName);
    if (typeof elqGuid !== 'undefined') {
      var matchPat = elqGuid.includes(elqGuidSuffix) ? elqGuidCookiePat + elqGuidSuffix : elqGuidCookiePat;
      elqGuid = elqGuid.match(matchPat)[1];
      elqGuidType = eatonElqFirstParty;
    }
  } else if (elqGuidTimeout <= elqGuidTimeoutHalf && elqGuidTimeout > 0) {

    // third party

    /* eslint-disable no-undef */
    window._elqQ = window._elqQ || [];
    window._elqQ.push(['elqGetCustomerGUID']);
    /* eslint-enable no-undef */

    /* eslint-disable no-undef, new-cap*/
    if (typeof GetElqCustomerGUID === 'function') {
      elqGuid = GetElqCustomerGUID();
      elqGuidType = eatonElqThirdParty;
    }
    /* eslint-enable no-undef, new-cap*/
  } else {

    // timeout
    console.error('First and third party eloqua guids not found.');
    clearInterval(elqGuidTimerId);
    return;
  }

  if (elqGuid) {

    // add to data layer and form
    /* eslint-disable no-undef*/
    dataLayer.eatonElqGUID = elqGuid;
    dataLayer.form === 'yes' && appendElqGuid(elqGuid);
    typeof LookupIdVisitor !== 'undefined' && window._elqQ.push(['elqDataLookup', escape(LookupIdVisitor), '']);
    /* eslint-enable no-undef*/
    clearInterval(elqGuidTimerId);
    return;
  }

  elqGuidTimeout -= 1;
};

$(document).ready(function () {
  // eslint-disable-next-line camelcase
  async_load();
  elqTrackingTimerId = setInterval(setEloquaTracking, 500);
});