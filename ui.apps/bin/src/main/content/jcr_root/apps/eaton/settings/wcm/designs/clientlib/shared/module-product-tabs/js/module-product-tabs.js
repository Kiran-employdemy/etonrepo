/**
 *
 *
 *
 * - THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY -
 * - Generated by Gulp (gulp-babel).
 *
 *
 *
 *
 */


//-----------------------------------
// Component M-40: Product Tabs shared module
//-----------------------------------
'use strict';

var App = window.App || {};
App.productTabs = function () {

  // Cached DOM Elements
  //--------------
  var $componentClass = $('.eaton-product-tabs');
  var $headerEl = $('.eaton-header');
  var $headerUtilityNav = $('.header-utility-nav');
  var $window = $(window);
  var $tabsDescription = $componentClass.find('.eaton-product-tabs__description');
  var $tabsDropdown = $componentClass.find('.dropdown'); // Bootstrap Dropdown Container
  var $tabsDropdownMenu = $componentClass.find('.dropdown-menu'); // Bootstrap Dropdown Element

  var $cookieAcceptance = $('.cookie-acceptancebox');
  var isCookieAcceptanceVisibile = false; // Default values
  var cookieAcceptanceHeight = 0; // Default values

  // CSS Selectors
  var componentFixedClass = 'eaton-product-tabs--fixed';

  // Utility Detect AEM's Author / Edit Mode
  var isAEMAuthorMode = App.global.utils.isAEMAuthorMode();

  /**
  * Initialize
  */
  var init = function init() {
    if (!isAEMAuthorMode) {
      addEventListeners();
    }
  };

  /**
   * Bind All Event Listeners
   */
  var addEventListeners = function addEventListeners() {

    // Listener that is fired when the cookie acceptance component GETS CLOSED
    $(document).on(App.global.constants.EVENTS.HEADER.COOKIE_SET, function () {
      //console.log('closed');
      isCookieAcceptanceVisibile = false;
      cookieAcceptanceHeight = 0;
    });

    var lazyResize = App.global.utils.throttle(onWindowResize, 200);
    $window.on('resize', lazyResize);

    var onScroll = function onScroll(event) {
      var scrollTop = $window.scrollTop();
      var isMobile = $window.innerWidth() < App.global.constants.GRID.MD;
      var headerHeight = $headerEl.outerHeight();
      var tabsDescriptionHeight = $tabsDescription.outerHeight();
      var utilityNavOffset = $headerUtilityNav.length > 0 ? $headerUtilityNav.offset().top : 0;
      var utilityNavHeight = $headerUtilityNav.outerHeight();
      var isHeaderFixed = scrollTop > utilityNavOffset + utilityNavHeight;

      // If cookie acceptance wasn't visible on page load but it became visible
      if (!isCookieAcceptanceVisibile && $cookieAcceptance.is(':visible')) {
        isCookieAcceptanceVisibile = true;
        cookieAcceptanceHeight = $cookieAcceptance.outerHeight();
      }

      // if Mobile add the tabsDescriptionHeight
      var isTop = scrollTop === 0;
      var scrollOffset = headerHeight + tabsDescriptionHeight + cookieAcceptanceHeight;
      var shouldBeFixed = isHeaderFixed && !isTop;
      shouldBeFixed = isMobile ? scrollTop > scrollOffset : shouldBeFixed;

      // const scrollOffset = headerHeight + (isMobile ? tabsDescriptionHeight : 0);
      // const shouldBeFixed = (isHeaderFixed && !isTop) || (scrollTop > scrollOffset);

      // EATON-619: Dropdown should close when user has it open then scrolls down.
      closeDropdown();

      $componentClass.toggleClass(componentFixedClass, shouldBeFixed);
    };
	var lazyScroll = App.global.utils.throttle(onScroll, 15);
    $window.on('scroll', lazyScroll);
  };

  /**
  * It closes "How to Buy" Dropdown
  */
  var closeDropdown = function closeDropdown() {
    if ($tabsDropdown.hasClass('open')) {

      // Call Bootstrap's Method to toggle the state of the dropdown
      $tabsDropdownMenu.dropdown('toggle');
    }
  };

  /**
  * OnWindowResize
  * @param {Object} event - jQuery's Window-Resize event
  */
  var onWindowResize = function onWindowResize() {

    // It recalculates the height of the CookieAcceptance component when the window is resized
    if (isCookieAcceptanceVisibile) {
      cookieAcceptanceHeight = $cookieAcceptance.outerHeight();
    }
  };

  /**
  * If containing DOM element is found, Initialize and Expose public methods
  */
  if ($componentClass.length > 0) {
    init();
  }
}();