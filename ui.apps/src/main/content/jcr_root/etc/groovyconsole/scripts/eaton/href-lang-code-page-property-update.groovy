package etc.groovyconsole.scripts.eaton

import groovy.transform.Field

@Field final CONTENT_PATH = "/content/"
@Field final SLASH_STRING = "/"
@Field final JCR_CONTENT = "jcr:content"

/* If this is set to true, no actual content changes will be made, but the changes
   that would have been made will be reported */
@Field final DRY_RUN_FLAG = true
@Field final changedLanguagePageArr = [ ]


def jsonSlurper = new JsonSlurper(type: JsonParserType.INDEX_OVERLAY)
def jsonSlurObj = jsonSlurper.parseText('{"hrefLangJson":[{"domain":"eaton","country":"us","language":"en-us","hrefLangCode":"en-us"},{"domain":"eaton","country":"au","language":"en-gb","hrefLangCode":"en-au"},{"domain":"eaton","country":"at","language":"en-gb","hrefLangCode":"en-at"},{"domain":"eaton","country":"at","language":"de-de","hrefLangCode":"de-at"},{"domain":"eaton","country":"be","language":"nl-nl","hrefLangCode":"nl-be"},{"domain":"eaton","country":"be","language":"en-gb","hrefLangCode":"en-be"},{"domain":"eaton","country":"be","language":"fr-fr","hrefLangCode":"fr-be"},{"domain":"eaton","country":"br","language":"en-us","hrefLangCode":"en-br"},{"domain":"eaton","country":"br","language":"pt-br","hrefLangCode":"pt-br"},{"domain":"eaton","country":"bg","language":"en-gb","hrefLangCode":"en-bg"},{"domain":"eaton","country":"ca","language":"en-gb","hrefLangCode":"en-ca"},{"domain":"eaton","country":"ca","language":"fr-ca","hrefLangCode":"fr-ca"},{"domain":"eaton","country":"cn","language":"en-us","hrefLangCode":"en-cn"},{"domain":"eaton","country":"cn","language":"zh-cn","hrefLangCode":"zh-ch"},{"domain":"eaton","country":"cz","language":"en-gb","hrefLangCode":"en-cz"},{"domain":"eaton","country":"cz","language":"cs-cz","hrefLangCode":"cs-cz"},{"domain":"eaton","country":"dk","language":"en-gb","hrefLangCode":"en-dk"},{"domain":"eaton","country":"dk","language":"da-dk","hrefLangCode":"da-dk"},{"domain":"eaton","country":"ee","language":"en-gb","hrefLangCode":"en-ee"},{"domain":"eaton","country":"ee","language":"et-ee","hrefLangCode":"et-ee"},{"domain":"eaton","country":"fi","language":"en-gb","hrefLangCode":"en-fi"},{"domain":"eaton","country":"fi","language":"fi-fi","hrefLangCode":"fi-fi"},{"domain":"eaton","country":"fr","language":"en-gb","hrefLangCode":"en-fr"},{"domain":"eaton","country":"fr","language":"fr-fr","hrefLangCode":"fr-fr"},{"domain":"eaton","country":"de","language":"en-gb","hrefLangCode":"en-de"},{"domain":"eaton","country":"de","language":"de-de","hrefLangCode":"de-de"},{"domain":"eaton","country":"hu","language":"en-gb","hrefLangCode":"en-hu"},{"domain":"eaton","country":"hu","language":"hu-hu","hrefLangCode":"hu-hu"},{"domain":"eaton","country":"in","language":"en-us","hrefLangCode":"en-in"},{"domain":"eaton","country":"il","language":"en-gb","hrefLangCode":"en-il"},{"domain":"eaton","country":"il","language":"he-il","hrefLangCode":"he-il"},{"domain":"eaton","country":"ie","language":"en-gb","hrefLangCode":"en-ie"},{"domain":"eaton","country":"it","language":"en-gb","hrefLangCode":"en-it"},{"domain":"eaton","country":"it","language":"it-it","hrefLangCode":"it-it"},{"domain":"eaton","country":"ke","language":"en-gb","hrefLangCode":"en-ke"},{"domain":"eaton","country":"lv","language":"en-gb","hrefLangCode":"en-lv"},{"domain":"eaton","country":"lv","language":"lv-lv","hrefLangCode":"lv-lv"},{"domain":"eaton","country":"lt","language":"en-gb","hrefLangCode":"en-lt"},{"domain":"eaton","country":"lt","language":"lt-lt","hrefLangCode":"lt-lt"},{"domain":"eaton","country":"mx","language":"en-us","hrefLangCode":"en-mx"},{"domain":"eaton","country":"mx","language":"es-mx","hrefLangCode":"es-mx"},{"domain":"eaton","country":"nl","language":"en-gb","hrefLangCode":"en-nl"},{"domain":"eaton","country":"nl","language":"nl-nl","hrefLangCode":"nl-nl"},{"domain":"eaton","country":"nz","language":"en-gb","hrefLangCode":"en-nz"},{"domain":"eaton","country":"ng","language":"en-gb","hrefLangCode":"en-ng"},{"domain":"eaton","country":"no","language":"en-gb","hrefLangCode":"en-no"},{"domain":"eaton","country":"no","language":"no-no","hrefLangCode":"no-no"},{"domain":"eaton","country":"pl","language":"en-gb","hrefLangCode":"en-pl"},{"domain":"eaton","country":"pl","language":"pl-pl","hrefLangCode":"pl-pl"},{"domain":"eaton","country":"pt","language":"en-gb","hrefLangCode":"en-pt"},{"domain":"eaton","country":"pt","language":"pt-pt","hrefLangCode":"pt-pt"},{"domain":"eaton","country":"ro","language":"en-gb","hrefLangCode":"en-ro"},{"domain":"eaton","country":"ro","language":"ro-ro","hrefLangCode":"ro-ro"},{"domain":"eaton","country":"ru","language":"en-gb","hrefLangCode":"en-ru"},{"domain":"eaton","country":"ru","language":"ru-ru","hrefLangCode":"ru-ru"},{"domain":"eaton","country":"sg","language":"en-us","hrefLangCode":"en-sg"},{"domain":"eaton","country":"sk","language":"en-gb","hrefLangCode":"en-sk"},{"domain":"eaton","country":"sk","language":"sk-sk","hrefLangCode":"sk-sk"},{"domain":"eaton","country":"za","language":"en-gb","hrefLangCode":"en-za"},{"domain":"eaton","country":"es","language":"en-gb","hrefLangCode":"en-es"},{"domain":"eaton","country":"es","language":"es-es","hrefLangCode":"es-es"},{"domain":"eaton","country":"se","language":"en-gb","hrefLangCode":"en-se"},{"domain":"eaton","country":"se","language":"sv-se","hrefLangCode":"sv-se"},{"domain":"eaton","country":"ch","language":"fr-fr","hrefLangCode":"fr-ch"},{"domain":"eaton","country":"ch","language":"it-it","hrefLangCode":"it-ch"},{"domain":"eaton","country":"ch","language":"en-gb","hrefLangCode":"en-ch"},{"domain":"eaton","country":"ch","language":"de-de","hrefLangCode":"de-ch"},{"domain":"eaton","country":"tr","language":"en-gb","hrefLangCode":"en-tr"},{"domain":"eaton","country":"tr","language":"tr-tr","hrefLangCode":"tr-tr"},{"domain":"eaton","country":"ua","language":"en-gb","hrefLangCode":"en-ua"},{"domain":"eaton","country":"ua","language":"uk-ua","hrefLangCode":"uk-ua"},{"domain":"eaton","country":"ae","language":"en-gb","hrefLangCode":"en-ae"},{"domain":"eaton","country":"gb","language":"en-gb","hrefLangCode":"en-gb"},{"domain":"eaton","country":"dz","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"ao","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"bh","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"by","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"by","language":"ru-ru","hrefLangCode":""},{"domain":"eaton","country":"bw","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"cm","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"cf","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"cg","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"cd","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"hr","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"dj","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"eg","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"et","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"ga","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"gh","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"gr","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"jp","language":"en-us","hrefLangCode":""},{"domain":"eaton","country":"jp","language":"ja-jp","hrefLangCode":"ja-jp"},{"domain":"eaton","country":"jo","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"kw","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"lb","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"lu","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"lu","language":"fr-fr","hrefLangCode":""},{"domain":"eaton","country":"lu","language":"de-de","hrefLangCode":""},{"domain":"eaton","country":"mg","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"mw","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"mu","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"ma","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"ma","language":"fr-fr","hrefLangCode":"fr-ma"},{"domain":"eaton","country":"mz","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"na","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"ne","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"om","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"qa","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"re","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"rw","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"sa","language":"en-gb","hrefLangCode":"en-sa"},{"domain":"eaton","country":"rs","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"sc","language":"en-eg","hrefLangCode":""},{"domain":"eaton","country":"kr","language":"en-us","hrefLangCode":""},{"domain":"eaton","country":"kr","language":"ko-kr","hrefLangCode":"ko-kr"},{"domain":"eaton","country":"sd","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"tw","language":"en-us","hrefLangCode":"en-tw"},{"domain":"eaton","country":"tw","language":"zh-tw","hrefLangCode":"zh-tw"},{"domain":"eaton","country":"tz","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"tn","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"ug","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"sg","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"zm","language":"en-gb","hrefLangCode":""},{"domain":"eaton","country":"zw","language":"en-gb","hrefLangCode":""},{"domain":"eaton-cummins","country":"us","language":"en-us","hrefLangCode":"en-us"},{"domain":"greenswitching","country":"us","language":"en-us","hrefLangCode":"en-us"},{"domain":"greenswitching","country":"fr","language":"fr-fr","hrefLangCode":"fr-fr"},{"domain":"greenswitching","country":"gb","language":"en-gb","hrefLangCode":"en-gb"},{"domain":"greenswitching","country":"de","language":"de-de","hrefLangCode":"de-de"},{"domain":"phoenixtec","country":"us","language":"en-us","hrefLangCode":"en-us"}]}')
def propName = "hrefLangCode"



for(def item : jsonSlurObj.hrefLangJson){
    def langPagePath = CONTENT_PATH+item.domain+SLASH_STRING+item.country+SLASH_STRING+item.language+SLASH_STRING
    def propValue = item.hrefLangCode
    def langPage = getPage(langPagePath)
    if(langPage != null){
        def jcrContentNode = langPage.node
        if (jcrContentNode.hasProperty(propName)) {
            def oldPropValue = jcrContentNode.getProperty(propName).getString();
            if(!oldPropValue.equals(propValue)) {
                if(!DRY_RUN_FLAG) {
                    jcrContentNode.setProperty(propName, propValue)
                }
            }
            changedLanguagePageArr.add(langPagePath+JCR_CONTENT)
        } else {
            if(!DRY_RUN_FLAG) {
                jcrContentNode.setProperty(propName, propValue);
            }
            changedLanguagePageArr.add(langPagePath+JCR_CONTENT)
        }
    }
}

if(!DRY_RUN_FLAG) {
    save()
}

if(changedLanguagePageArr.size() > 0){
    println "\nHref Lang Code page property for following pages have been or will be updated(if dry_run is false) and count is : "+changedLanguagePageArr.size()
    for(int index = 0; index<changedLanguagePageArr.size(); index++) {
        println changedLanguagePageArr[index]
    }

}