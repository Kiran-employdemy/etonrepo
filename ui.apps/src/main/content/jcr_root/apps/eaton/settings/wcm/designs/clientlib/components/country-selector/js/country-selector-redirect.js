/**
 *
 *
 *
 * - THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY -
 * - Generated by Gulp (gulp-babel).
 *
 *
 *
 *
 */


'use strict';

/* eslint-disable no-undef */
/* eslint-disable no-global-assign */
// noinspection JSConstantReassignment

if (typeof require !== 'undefined') {
  var constants = require('../../../global/js/etn-new-global-constants');
  var selectorConstants = require('./country-selector-redirect-constants');
  countrySelectionConstants = selectorConstants.countrySelectionConstants;
  suffixes = constants.suffixes;
  pathsTo = constants.pathsTo;
  cookies = constants.cookies;
  dates = constants.dates;
  elementAttributes = constants.elementAttributes;
  urls = constants.urls;
}

var extractCountryLanguageFromHrefUrl = function extractCountryLanguageFromHrefUrl(href, isExternalLink) {
  var countryLanguage = href.replace(pathsTo.EATON_ROOT, '').replace(pathsTo.LOGIN_ROOT, '').replace(pathsTo.LOGIN_PATH, '').replace(suffixes.HTML, '');
  if (isExternalLink) {
    var url = new URL(href);
    countryLanguage = url.pathname.substring(0, url.pathname.indexOf(suffixes.HTML));
  }
  return countryLanguage;
};

var setEtnRedirectCookieIfCookiesAreAccepted = function setEtnRedirectCookieIfCookiesAreAccepted(countryLanguage) {
  if (document.cookie.indexOf(cookies.acceptance) > -1) {
    document.cookie = cookies.eatonRedirect.cookie(countryLanguage, true);
  }
};

var extractUrlFromRedirectCookie = function extractUrlFromRedirectCookie(countryLanguage) {
  var redirectCookieValue = cookies.extractValueFor(cookies.deepLinkRedirect.name);
  return redirectCookieValue.replace(/(\/[a-z]{2}\/[a-z]{2}-[a-z]{2}|hongkong)/, countryLanguage);
};

var bindToEachCountrySelectionLinkCookieSettingClickEvent = function bindToEachCountrySelectionLinkCookieSettingClickEvent() {
  document.querySelectorAll(countrySelectionConstants.querySelectors.allLinks).forEach(function (link) {
    link.onclick = function (event) {
      event.preventDefault();
      var href = link.getAttribute(elementAttributes.reference);
      var isExternalLink = urls.isExternalLink(href);
      var countryLanguage = extractCountryLanguageFromHrefUrl(href, isExternalLink);
      setEtnRedirectCookieIfCookiesAreAccepted(countryLanguage);
      if (cookies.isPresent(cookies.deepLinkRedirect.name)) {
        href = extractUrlFromRedirectCookie(countryLanguage);
        document.cookie = cookies.deepLinkRedirect.cookie(cookies.extractValueFor(cookies.deepLinkRedirect.name), true);
        if (isExternalLink) {
          window.location = link.getAttribute(elementAttributes.reference).replace(countryLanguage + suffixes.HTML, href);
          return;
        }
      }
      if (isExternalLink) {
        window.location = href;
        return;
      }
      window.location = window.location.href.replace(countrySelectionConstants.pathsTo.selectionPage, '') + href;
    };
  });
};

document.addEventListener('DOMContentLoaded', function () {
  bindToEachCountrySelectionLinkCookieSettingClickEvent();
  var elementClasses = countrySelectionConstants.elementClasses;
  var querySelectors = countrySelectionConstants.querySelectors;
  var collapseDesktop = function collapseDesktop(x) {
    if (x.matches) {
      document.querySelectorAll(querySelectors.countryBlock).forEach(function (countryBlock) {
        countryBlock.classList.add(elementClasses.collapse);
        countryBlock.classList.add(elementClasses.inwards);
      });
      document.querySelectorAll(querySelectors.countrySelectorIcons).forEach(function (countrySelectorIcon) {
        countrySelectorIcon.classList.add(elementClasses.iconMinus);
        countrySelectorIcon.classList.remove(elementClasses.iconPlus);
      });
    }
  };
  var x = window.matchMedia('(min-width: 992px)');
  collapseDesktop(x);
  x.addEventListener('change', collapseDesktop);
});